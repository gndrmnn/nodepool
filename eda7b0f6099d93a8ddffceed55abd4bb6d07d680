{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "64f865cc_97bce30a",
        "filename": "nodepool/driver/utils.py",
        "patchSetId": 2
      },
      "lineNbr": 510,
      "author": {
        "id": 16068
      },
      "writtenOn": "2023-03-17T07:25:34Z",
      "side": 1,
      "message": "Since thread locking can also be expensive when done frequently without the need, I think we should move the cache hit path out of the lock.",
      "revId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f7f2117b_b350e753",
        "filename": "nodepool/driver/utils.py",
        "patchSetId": 2
      },
      "lineNbr": 510,
      "author": {
        "id": 1
      },
      "writtenOn": "2023-03-17T14:34:52Z",
      "side": 1,
      "message": "Two things:\n1) timeit says the thread lock and unlock takes something like 0.00000014045762305613 seconds.  We will be calling this once or twice for every state machine advance, so we do want it to be fast, but we also really want to avoid errors, deadlocks, and extra API calls.  It\u0027s fast enough that I think we should set a high bar for redesign.\n2) The section above this needs to be in the lock because of the future check, so I don\u0027t see how to remove this section from the lock without adding more complexit.",
      "parentUuid": "64f865cc_97bce30a",
      "revId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1ed8b75_23a40f42",
        "filename": "nodepool/driver/utils.py",
        "patchSetId": 2
      },
      "lineNbr": 510,
      "author": {
        "id": 1
      },
      "writtenOn": "2023-03-17T14:48:10Z",
      "side": 1,
      "message": "Okay, with a little duplication I think we can do what you ask:\nif cached data present and not expired and no pending future:\n  return cached data\nelse:\n  lines 502-532 exactly as written now.\n\nIt\u0027s a little duplicative, but efficient without added complexity.  I can do that if you want.",
      "parentUuid": "64f865cc_97bce30a",
      "revId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c4d36e01_8b572355",
        "filename": "nodepool/driver/utils.py",
        "patchSetId": 2
      },
      "lineNbr": 510,
      "author": {
        "id": 1
      },
      "writtenOn": "2023-03-17T14:49:18Z",
      "side": 1,
      "message": "Er, that else clause would be \"with lock\".",
      "parentUuid": "64f865cc_97bce30a",
      "revId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "serverId": "4a232e18-c5a9-48ee-94c0-e04e7cca6543"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "Code reviewed by core reviewer"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX AND -label:Code-Review\u003dMIN"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX AND -label:Code-Review=MIN"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["label:Code-Review=MAX"],"failingAtoms":["label:Code-Review=MIN"]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Verified",
        "description": {
          "value": "Verified in gate by CI"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Verified\u003dMAX AND -label:Verified\u003dMIN"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Verified=MAX AND -label:Verified=MIN"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["label:Verified=MAX"],"failingAtoms":["label:Verified=MIN"]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Workflow",
        "description": {
          "value": "Approved for gate by core reviewer"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Workflow\u003dMAX AND -label:Workflow\u003dMIN"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Workflow=MAX AND -label:Workflow=MIN"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["label:Workflow=MAX"],"failingAtoms":["label:Workflow=MIN"]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "eda7b0f6099d93a8ddffceed55abd4bb6d07d680",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}